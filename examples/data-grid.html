<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">

	<link rel="stylesheet" type="text/css" href="../dist/data-grid.min.css">
	<link rel="stylesheet" type="text/css" href="../dist/simple-theme.min.css">
	<script src="../dist/data-grid.min.js"></script>

	<style type="text/css">
		* {
			box-sizing: border-box;
		}
		html, body {
			height: 100%;
		}
		body {
			margin: 0;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		#parentDiv {
			height: 100%;
			width: 100%;
			position: relative;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		#grid {
			width: 50%;
			height: 90%;
		}
		button.destroy-grid, button.rearrange-cols {
			position: absolute;
			top: 10px;
		}
		button.rearrange-cols { left: 43%; }
		button.destroy-grid { left: calc(43% + 160px); }
	</style>

	<script src="data.js"></script>
	<script>
		loadBulk(1000);

		var testGrid;
		document.addEventListener("DOMContentLoaded", function(e) {
			document.getElementById('grid').addEventListener('grid-loaded', function(e) {
				e.detail.gridObj.scrollY += 500;
			}, { capture: false });

			testGrid = new storkGrid({
				element: document.getElementById('grid'),
				data: window.bigData,
				rowHeight: 30,
				headerHeight: 50,
				sortable: true,
				selection: {
					multi: false,
					type: 'row'
				},
				columns: [
					{ dataName: 'id', displayName: 'ID', width: 70, fixed: true },
					{ dataName: 'eretz', displayName: 'Eretz', width: 110, minWidth: 70 },
					{ dataName: 'eer', displayName: 'Eer', width: 115, minWidth: 75, fixed: true },
					{ dataName: 'hai', displayName: 'Hai', width: 110 },
					{ dataName: 'tzomeah', displayName: 'Tzomeah', width: 120 },
					{ dataName: 'domem', displayName: 'Domem', width: 125 },
					{ dataName: 'yeled', displayName: 'Yeled' },
					{ dataName: 'yalda', displayName: 'Yalda' },
					{ dataName: 'reg-amount', displayName: 'Reg Amount', width: 110 },
					{ dataName: 'other_amount', displayName: 'Other Amount', width: 110 }
				],
				minColumnWidth: 65,
				resizableColumns: true,
				trackBy: 'other_amount',
				onload: function(e) { // another way to add onLoad listener
					e.detail.gridObj.scrollY += 2000;
				}
			});

			testGrid.addEventListener('select', function(e) {
				console.log('select: ', e.detail);
			}, false);
			testGrid.addEventListener('dblselect', function(e) {
				console.log('double select: ', e.detail);
			}, false);

			testGrid.addScrollEvent('almostHitBottom', 100); // when to emit
			testGrid.addEventListener('almostHitBottom', function(e) {
				var dataLength = testGrid.data.length;
				loadBulk(40);
				if(testGrid.data.length > dataLength) {
					testGrid.refreshData();
				}
			}, false);

			var forceRefresh = false;
			var loadedDataTO;
			testGrid.addScrollEvent('almostHitTop', 100, false); // when to emit
			testGrid.addEventListener('almostHitTop', function(e) {
				var dataLength = testGrid.data.length;
				loadBulk(900, true);
				if(testGrid.data.length > dataLength) {
					testGrid.scrollY += 1200;
					forceRefresh = true;
					clearTimeout(loadedDataTO);
					loadedDataTO = setTimeout(function() { forceRefresh = false; }, 500);
				}

				// will keep refreshing the view on each scroll up, for 500ms since last successful 'loadBulk'.
				// this solves a bug when user drags the scrollbar up and the browser keeps emitting 'scrollTop=0'
				if(forceRefresh) {
					testGrid.refreshData();
				}
			}, false);

			testGrid.addEventListener('sort', function(e) {
				console.log(e.detail);
			}, false);

			testGrid.addEventListener('resize-column', function(e) {
				console.log(e.detail);
			}, false);
		});

		var destroyGrid = function destroyGrid() {
			if(testGrid) {
				testGrid.destroy();
			}
		};

		var rearrange = function rearrange() {
			if(testGrid && testGrid.grid) {
				testGrid.setColumns([
					{dataName: 'eretz', displayName: 'Eretz', width: 110, minWidth: 70, fixed: true},
					{dataName: 'reg-amount', displayName: 'Reg Amount', width: 110, fixed: true},
					{dataName: 'other_amount', displayName: 'Other Amount', width: 110},
					{dataName: 'eer', displayName: 'Eer', width: 115, minWidth: 75},
					{dataName: 'id', displayName: 'ID', width: 70}
				]);
			}
		};
	</script>
</head>
<body>
<div id="parentDiv">
	<button class="destroy-grid" onclick="destroyGrid();">Destroy grid</button>
	<button class="rearrange-cols" onclick="rearrange();">Rearrange columns</button>
	<div id="grid"></div>
</div>
</body>
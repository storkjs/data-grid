!function(root){"use strict";var changeTranslate=function(elm,direction,amount){elm.storkGridProps||(elm.storkGridProps={}),elm.storkGridProps.translateX||(elm.storkGridProps.translateX=0),elm.storkGridProps.translateY||(elm.storkGridProps.translateY=0),"X"===direction.toUpperCase()?(elm.storkGridProps.translateX=amount,elm.style.transform="translate("+amount+"px,"+elm.storkGridProps.translateY+"px)"):"Y"===direction.toUpperCase()&&(elm.storkGridProps.translateY=amount,elm.style.transform="translate("+elm.storkGridProps.translateX+"px,"+amount+"px)")},storkGrid=function(options){if(this.grid=options.element,this.data=options.data||[],this.rowHeight=options.rowHeight||32,this.headerHeight=options.headerHeight||this.rowHeight,this.columns=options.columns||[],this.minColumnWidth=options.minColumnWidth||50,this.resizableColumns=options.resizableColumns!==!1,this.sortable=options.sortable!==!1,this.trackBy=options.trackBy||null,this.onload=options.onload||null,this.selection={},options.selection=options.selection||{},this.selection.multi=options.selection.multi||!1,this.selection.type="cell"===options.selection.type?"cell":"row",this.rnd||(this.rnd=1e3*(Math.floor(9*Math.random())+1)+Date.now()%1e3),this.tableExtraSize=.4,this.tableExtraPixelsForThreshold=0,this.cellBorders={headerTotal:0,headerDeviation:0,dataTotal:0,dataDeviation:0},this.headerTable={wrapper:null,loose:null,fixed:null,resizer_loose:null,resizer_fixed:null,ths:[]},this.dataTables=[],this.dataWrapperElm=null,this.dataElm=null,this.selectedItems=new Map,this.clickedItem=null,this.hoveredRowElm=null,this.customScrollEvents=[],this.eventListeners=[],this.scrollY=0,this.scrollX=0,this.maxScrollY=0,this.lastScrollTop=0,this.lastScrollDirection="static",this.lastScrollLeft=0,this.lastThreshold=0,this.nextThreshold=0,this.totalDataWidthFixed=0,this.totalDataWidthLoose=0,this.totalDataHeight=0,this.dataViewHeight=0,this.dataTableHeight=0,this.numDataRowsInTable=0,0===this.columns.length&&this.data.length>0){var columnName;for(var key in this.data[0])this.data[0].hasOwnProperty(key)&&(columnName=key.replace(/[-_]/," "),columnName=columnName.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()}),this.columns.push({dataName:key,displayName:columnName,width:0,minWidth:0,fixed:!1}))}else{var i,fixedColumns=[],looseColumns=[];for(i=0;i<this.columns.length;i++)this.columns[i].fixed?fixedColumns.push(this.columns[i]):looseColumns.push(this.columns[i]);this.columns=fixedColumns.concat(looseColumns)}if(this.grid.classList.add("stork-grid","stork-grid"+this.rnd),this.grid.setAttribute("tabindex",0),!this.columns.length)return void console.warn("Can not build grid without any columns");this.makeHeaderTable(),this.initDataView(),this.updateViewData(0,0),this.updateViewData(1,1),this.resizableColumns&&this.makeColumnsResizable(),this.calculateColumnsWidths(),this.makeCssRules(),this.sortable&&this._addEventListener(this.headerTable.wrapper,"click",this.onHeaderClick.bind(this),!1),this._addEventListener(this.dataWrapperElm,"mousedown",this.onDataClick.bind(this),!1),this._addEventListener(this.grid,"keydown",this._onKeyboardNavigate.bind(this),!1),this._addEventListener(this.dataWrapperElm,"scroll",this.onDataScroll.bind(this),!1),this._addEventListener(document,"click",this._onClickCheckFocus.bind(this),!0),this._addEventListener(document,"copy",this.onCopy.bind(this),!0);var evnt=new CustomEvent("grid-loaded",{bubbles:!0,cancelable:!0,detail:{gridObj:this}});this.onload&&this.onload(evnt),this.grid.dispatchEvent(evnt)};storkGrid.prototype._addEventListener=function(element,type,listener,options_or_useCapture){return element.addEventListener(type,listener,options_or_useCapture),this.eventListeners.push({element:element,type:type,listener:listener,options:options_or_useCapture}),this.eventListeners.length-1},storkGrid.prototype._removeEventListener=function(index){var currEL=this.eventListeners[index];currEL&&currEL.element.removeEventListener(currEL.type,currEL.listener,currEL.options),this.eventListeners[index]=null},storkGrid.prototype._emptyEventListeners=function(){for(var i=0;i<this.eventListeners.length;i++)this.eventListeners[i].element.removeEventListener(this.eventListeners[i].type,this.eventListeners[i].listener,this.eventListeners[i].options);this.eventListeners.length=0},storkGrid.prototype.addEventListener=function(type,listener,options_or_useCapture){this._addEventListener(this.grid,type,listener,options_or_useCapture)},storkGrid.prototype.removeEventListener=function(type,listener,options_or_useCapture){this.grid.removeEventListener(type,listener,options_or_useCapture);for(var i=0;i<this.eventListeners.length;i++)this.eventListeners[i].element===this.grid&&this.eventListeners[i].type===type&&this.eventListeners[i].listener===listener&&this.eventListeners.splice(i,1)},storkGrid.prototype._dispatchSelectEvent=function(type,dataIndex,column,trackByData){"dblselect"!==type&&(type="select");var evnt=new CustomEvent(type,{bubbles:!0,cancelable:!0,detail:{dataIndex:dataIndex,column:column,isSelect:this.selectedItems.has(trackByData)}});this.grid.dispatchEvent(evnt)},storkGrid.prototype.addScrollEvent=function(type,amount,fromBottom){fromBottom=fromBottom!==!1,this.customScrollEvents.push({type:type,amount:amount,fromBottom:fromBottom})},storkGrid.prototype.calculateColumnsWidths=function(){this.totalDataWidthLoose=0,this.totalDataWidthFixed=0;var i,availableWidth,availableWidthPerColumn,roundedPixels,userDefinedWidth=0,numColumnsNotDefined=0;for(i=0;i<this.columns.length;i++)this.columns[i].width=this.columns[i].width||0,this.columns[i].minWidth=this.columns[i].minWidth||0,this.columns[i].width?(this.columns[i].width=Math.max(this.columns[i].width,this.columns[i].minWidth,this.minColumnWidth),userDefinedWidth+=this.columns[i].width):numColumnsNotDefined++;for(availableWidth=this.dataWrapperElm.clientWidth-userDefinedWidth,availableWidthPerColumn=0,numColumnsNotDefined>0&&(availableWidthPerColumn=Math.floor(availableWidth/numColumnsNotDefined)),roundedPixels=availableWidth%numColumnsNotDefined,i=0;i<this.columns.length;i++)this.columns[i].width||(this.columns[i].width=Math.max(this.columns[i].minWidth,this.minColumnWidth,availableWidthPerColumn),roundedPixels&&this.columns[i].width===availableWidthPerColumn&&(this.columns[i].width+=roundedPixels,roundedPixels=0)),this.columns[i].fixed?this.totalDataWidthFixed+=this.columns[i].width:this.totalDataWidthLoose+=this.columns[i].width},storkGrid.prototype.makeCssRules=function(){var style=document.getElementById("grid"+this.rnd+"_style");style||(style=document.createElement("style"),style.id="grid"+this.rnd+"_style",style.type="text/css",document.getElementsByTagName("head")[0].appendChild(style));var cellStyle=this.dataTables[0].rows[0].tds[0].currentStyle||window.getComputedStyle(this.dataTables[0].rows[0].tds[0]);this.cellBorders.dataTotal=parseInt(cellStyle.borderTopWidth,10)+parseInt(cellStyle.borderBottomWidth,10),this.cellBorders.dataDeviation=Math.ceil(this.cellBorders.dataTotal/2),cellStyle=this.headerTable.ths[0].currentStyle||window.getComputedStyle(this.headerTable.ths[0]),this.cellBorders.headerTotal=parseInt(cellStyle.borderTopWidth,10)+parseInt(cellStyle.borderBottomWidth,10),this.cellBorders.headerDeviation=Math.ceil(this.cellBorders.headerTotal/2);var html=".stork-grid"+this.rnd+" div.header > table th,.stork-grid"+this.rnd+" div.header > table.resizers a { height: "+(this.headerHeight-this.cellBorders.headerDeviation)+"px; }";html+=".stork-grid"+this.rnd+" div.header > table th > div { max-height: "+(this.headerHeight-this.cellBorders.headerDeviation)+"px; }",html+=".stork-grid"+this.rnd+" div.data > table td { height: "+this.rowHeight+"px; }",html+=".stork-grid"+this.rnd+" div.data > table td > div { max-height: "+(this.rowHeight-this.cellBorders.dataTotal)+"px; }";for(var i=0;i<this.columns.length;i++)html+=".stork-grid"+this.rnd+" th."+this.columns[i].dataName+",.stork-grid"+this.rnd+" td."+this.columns[i].dataName+" { width: "+this.columns[i].width+"px; }";html+=".stork-grid"+this.rnd+" div.header > table.loose,.stork-grid"+this.rnd+" div.data-wrapper > div.data > table.loose { width: "+this.totalDataWidthLoose+"px; }",html+=".stork-grid"+this.rnd+" div.header > table.fixed,.stork-grid"+this.rnd+" div.data-wrapper > div.data > table.fixed { width: "+this.totalDataWidthFixed+"px; }",html+=".stork-grid"+this.rnd+" div.data-wrapper > div.data { width: "+(this.totalDataWidthLoose+this.totalDataWidthFixed)+"px; }",style.innerHTML=html,this.headerTable.loose.style.marginLeft=this.totalDataWidthFixed+"px",this.headerTable.resizer_loose&&(this.headerTable.resizer_loose.style.marginLeft=this.totalDataWidthFixed+"px"),this.dataTables[0].table.style.marginLeft=this.totalDataWidthFixed+"px",this.dataTables[1].table.style.marginLeft=this.totalDataWidthFixed+"px"},storkGrid.prototype.setRowHeight=function(num){this.rowHeight=num,this.makeCssRules()},storkGrid.prototype.setHeaderHeight=function(num){this.headerHeight=num,this.makeCssRules()},storkGrid.prototype.makeHeaderTable=function(){var i,table=document.getElementById("grid"+this.rnd+"_headerTable"),tableFixed=document.getElementById("grid"+this.rnd+"_headerTable_fixed");if(table){for(;table.firstChild;)table.removeChild(table.firstChild);for(;tableFixed.firstChild;)tableFixed.removeChild(tableFixed.firstChild)}else{var headerDiv=document.createElement("div");headerDiv.classList.add("header"),this.headerTable.wrapper=headerDiv,table=document.createElement("table"),table.id="grid"+this.rnd+"_headerTable",table.classList.add("loose"),table.classList.add("columns"),this.headerTable.loose=table,tableFixed=document.createElement("table"),tableFixed.id="grid"+this.rnd+"_headerTable_fixed",tableFixed.classList.add("fixed"),tableFixed.classList.add("columns"),this.headerTable.fixed=tableFixed,headerDiv.appendChild(tableFixed),headerDiv.appendChild(table),this.grid.appendChild(headerDiv)}var th,thDiv,thead=document.createElement("thead"),theadFixed=document.createElement("thead"),tr=document.createElement("tr"),trFixed=document.createElement("tr");for(i=0;i<this.columns.length;i++)th=document.createElement("th"),th.classList.add(this.columns[i].dataName),thDiv=document.createElement("div"),thDiv.appendChild(document.createTextNode(this.columns[i].displayName)),th.appendChild(thDiv),th.storkGridProps={column:this.columns[i].dataName,sortState:null},this.headerTable.ths.push(th),this.columns[i].fixed?trFixed.appendChild(th):tr.appendChild(th);theadFixed.appendChild(trFixed),tableFixed.appendChild(theadFixed),thead.appendChild(tr),table.appendChild(thead)},storkGrid.prototype.initDataView=function(){this.dataWrapperElm=document.createElement("div"),this.dataWrapperElm.classList.add("data-wrapper"),this.dataWrapperElm.style.height="calc(100% - "+this.headerHeight+"px)",this.dataElm=document.createElement("div"),this.dataElm.classList.add("data"),this.calculateDataHeight(),this.dataWrapperElm.appendChild(this.dataElm),this.grid.appendChild(this.dataWrapperElm);var self=this;Object.defineProperty(self,"scrollY",{configurable:!0,enumerable:!0,get:function(){return self.dataWrapperElm.scrollTop||0},set:function(newValue){self.dataWrapperElm.scrollTop=newValue}}),Object.defineProperty(self,"scrollX",{configurable:!0,enumerable:!0,get:function(){return self.dataWrapperElm.scrollLeft||0},set:function(newValue){self.dataWrapperElm.scrollLeft=newValue}}),this.resize()},storkGrid.prototype.calculateDataHeight=function(){this.totalDataHeight=this.rowHeight*this.data.length,this.dataElm.style.height=this.totalDataHeight+"px",this.maxScrollY=Math.max(this.dataWrapperElm.scrollHeight-this.dataViewHeight,0)},storkGrid.prototype.resizeCalculate=function(){this.dataViewHeight=this.dataWrapperElm.clientHeight,this.dataViewHeight<this.rowHeight&&(this.dataViewHeight=this.rowHeight,console.warn("The Data Wrapper element was set too low. Height can't be less than the height of one row!")),this.maxScrollY=Math.max(this.dataWrapperElm.scrollHeight-this.dataViewHeight,0),this.numDataRowsInTable=Math.ceil(this.dataViewHeight*(1+this.tableExtraSize)/this.rowHeight),this.numDataRowsInTable%2===1&&this.numDataRowsInTable++,this.dataTableHeight=this.numDataRowsInTable*this.rowHeight,this.tableExtraPixelsForThreshold=Math.floor(this.dataTableHeight*(this.tableExtraSize/2)),this.lastThreshold=this.tableExtraPixelsForThreshold,this.nextThreshold=this.lastThreshold+this.dataTableHeight},storkGrid.prototype.buildDataTables=function(){for(var table,tableFixed,tbody,tbodyFixed,tr,trFixed,td,tdDiv,i,j,counter=0;2>counter;counter++){for(table=document.getElementById("grid"+this.rnd+"_dataTable"+counter),tableFixed=document.getElementById("grid"+this.rnd+"_dataTable_fixed"+counter),table||(tableFixed=document.createElement("table"),tableFixed.id="grid"+this.rnd+"_dataTable_fixed"+counter,tableFixed.classList.add("fixed"),table=document.createElement("table"),table.id="grid"+this.rnd+"_dataTable"+counter,table.classList.add("loose"),this.dataElm.appendChild(tableFixed),this.dataElm.appendChild(table));tableFixed.firstChild;)tableFixed.removeChild(tableFixed.firstChild);for(;table.firstChild;)table.removeChild(table.firstChild);for(this.dataTables[counter]={table:table,tableFixed:tableFixed,dataBlockIndex:null,rows:[]},tbody=document.createElement("tbody"),tbodyFixed=document.createElement("tbody"),i=0;i<this.numDataRowsInTable;i++){for(tr=document.createElement("tr"),trFixed=document.createElement("tr"),tr.storkGridProps={dataIndex:null,selected:!1},trFixed.storkGridProps=tr.storkGridProps,this.dataTables[counter].rows[i]={row:tr,rowFixed:trFixed,tds:[]},j=0;j<this.columns.length;j++)td=document.createElement("td"),td.classList.add(this.columns[j].dataName),td.storkGridProps={column:this.columns[j].dataName,selected:!1},tdDiv=document.createElement("div"),td.appendChild(tdDiv),this.dataTables[counter].rows[i].tds.push(td),this.columns[j].fixed?trFixed.appendChild(td):tr.appendChild(td);tbodyFixed.appendChild(trFixed),tbody.appendChild(tr)}tableFixed.appendChild(tbodyFixed),table.appendChild(tbody)}},storkGrid.prototype.repositionTables=function(currScrollDirection,currScrollTop,forceUpdateViewData){var topTableIndex,topTable,topTableFixed,bottomTableIndex,bottomTable,bottomTableFixed;currScrollTop=currScrollTop||this.scrollY,currScrollDirection=currScrollDirection||"down",forceUpdateViewData=forceUpdateViewData||!1;var currDataBlock=0;this.dataTableHeight>0&&(currDataBlock=Math.floor(currScrollTop/this.dataTableHeight)),topTableIndex=currDataBlock%2,topTable=this.dataTables[topTableIndex].table,topTableFixed=this.dataTables[topTableIndex].tableFixed,bottomTableIndex=(currDataBlock+1)%2,bottomTable=this.dataTables[bottomTableIndex].table,bottomTableFixed=this.dataTables[bottomTableIndex].tableFixed;var self=this,changeTranslateOfTables=function(){changeTranslate(topTable,"Y",currDataBlock*self.dataTableHeight),changeTranslate(topTableFixed,"Y",currDataBlock*self.dataTableHeight),changeTranslate(bottomTable,"Y",(currDataBlock+1)*self.dataTableHeight+self.cellBorders.dataDeviation),changeTranslate(bottomTableFixed,"Y",(currDataBlock+1)*self.dataTableHeight+self.cellBorders.dataDeviation)};"down"===currScrollDirection?(changeTranslateOfTables(),this.lastThreshold=currDataBlock*this.dataTableHeight+this.tableExtraPixelsForThreshold,currScrollTop>=this.lastThreshold?this.nextThreshold=this.lastThreshold+this.dataTableHeight:(this.nextThreshold=this.lastThreshold,this.lastThreshold-=this.dataTableHeight)):"up"===currScrollDirection&&(changeTranslateOfTables(),this.lastThreshold=(currDataBlock+1)*this.dataTableHeight+this.tableExtraPixelsForThreshold,currScrollTop<=this.lastThreshold?this.nextThreshold=this.lastThreshold-this.dataTableHeight:(this.nextThreshold=this.lastThreshold,this.lastThreshold+=this.dataTableHeight)),this.dataTables[topTableIndex].dataBlockIndex!==currDataBlock||forceUpdateViewData?this.updateViewData(topTableIndex,currDataBlock):(this.dataTables[bottomTableIndex].dataBlockIndex!==currDataBlock+1||forceUpdateViewData)&&this.updateViewData(bottomTableIndex,currDataBlock+1)},storkGrid.prototype.onDataScroll=function(e){var currScrollTop=e.target.scrollTop;if(currScrollTop!==this.lastScrollTop)this.onScrollY(currScrollTop);else{0===currScrollTop&&0===this.lastScrollTop&&this.onScrollY(currScrollTop);var currScrollLeft=e.target.scrollLeft;currScrollLeft!==this.lastScrollLeft&&this.onScrollX(currScrollLeft)}},storkGrid.prototype.onScrollY=function(currScrollTop){var scrollEvent,i,evnt,currScrollDirection=currScrollTop>=this.lastScrollTop?"down":"up";for((this.lastScrollDirection!==currScrollDirection||"down"===this.lastScrollDirection&&currScrollTop>=this.nextThreshold||"up"===this.lastScrollDirection&&currScrollTop<=this.nextThreshold)&&this.repositionTables(currScrollDirection,currScrollTop),this.lastScrollTop=currScrollTop,this.lastScrollDirection=currScrollDirection,i=0;i<this.customScrollEvents.length;i++)scrollEvent=this.customScrollEvents[i],(scrollEvent.fromBottom&&currScrollTop>=this.maxScrollY-scrollEvent.amount||!scrollEvent.fromBottom&&currScrollTop<=scrollEvent.amount)&&(evnt=new Event(scrollEvent.type,{bubbles:!0,cancelable:!0}),this.grid.dispatchEvent(evnt))},storkGrid.prototype.onScrollX=function(currScrollLeft){changeTranslate(this.headerTable.loose,"X",-currScrollLeft),this.headerTable.loose.style.transform="translateX(-"+currScrollLeft+"px)",this.headerTable.resizer_loose&&changeTranslate(this.headerTable.resizer_loose,"X",-currScrollLeft),changeTranslate(this.dataTables[0].tableFixed,"X",currScrollLeft),changeTranslate(this.dataTables[1].tableFixed,"X",currScrollLeft),this.totalDataWidthFixed>0&&currScrollLeft>=5&&this.lastScrollLeft<5?(this.dataTables[0].tableFixed.classList.add("covering"),this.dataTables[1].tableFixed.classList.add("covering"),this.headerTable.fixed.classList.add("covering")):5>currScrollLeft&&this.lastScrollLeft>=5&&(this.dataTables[0].tableFixed.classList.remove("covering"),this.dataTables[1].tableFixed.classList.remove("covering"),this.headerTable.fixed.classList.remove("covering")),this.lastScrollLeft=currScrollLeft};var lastClickTime=0,lastClickElm=null;storkGrid.prototype.onDataClick=function(e){if(0===e.button){for(var dataIndex,TR,selectedCellColumn,selectedItem,trackByData,TD=e.target,i=0,eventName="select";"TD"!==TD.tagName.toUpperCase();){if(i++>=2)return;TD=TD.parentNode}if(TR=TD.parentNode,dataIndex=parseInt(TR.storkGridProps.dataIndex,10),selectedCellColumn=TD.storkGridProps.column,dataIndex>=0&&dataIndex<this.data.length&&dataIndex<=Number.MAX_SAFE_INTEGER){trackByData=this._getTrackByData(dataIndex);var clickedElm,now=Date.now();if(clickedElm="cell"===this.selection.type?TD:TR,now-lastClickTime>300||clickedElm!==lastClickElm)if("row"===this.selection.type&&this.selection.multi===!0){if(1===this.selectedItems.size&&this.selectedItems.has(trackByData))this.selectedItems.clear(),this.clickedItem=null,this.hoveredRowElm=null;else{this.selectedItems.clear(),this.selectedItems.set(trackByData,[selectedCellColumn]),this.clickedItem={dataIndex:dataIndex,column:selectedCellColumn},this.hoveredRowElm=TR;var self=this,eventIndexes={mouse_move:null,mouse_up:null};eventIndexes.mouse_move=this._addEventListener(this.dataWrapperElm,"mousemove",this.onDataClickMove.bind(this),!1),eventIndexes.mouse_up=this._addEventListener(document,"mouseup",function(){self._removeEventListener(eventIndexes.mouse_move),self._removeEventListener(eventIndexes.mouse_up)},!1)}this.renderSelectOnRows()}else{if(this.selection.multi||this.selectedItems.has(trackByData)||this.selectedItems.clear(),this.selectedItems.has(trackByData))if("row"===this.selection.type)this.selectedItems.delete(trackByData),this.clickedItem=null;else{selectedItem=this.selectedItems.get(trackByData);var indexOfColumn=selectedItem.indexOf(selectedCellColumn);-1===indexOfColumn?(selectedItem.push(selectedCellColumn),this.clickedItem={dataIndex:dataIndex,column:selectedCellColumn}):(selectedItem.splice(indexOfColumn,1),0===selectedItem.length&&this.selectedItems.delete(trackByData),this.clickedItem=null)}else this.selectedItems.set(trackByData,[selectedCellColumn]),this.clickedItem={dataIndex:dataIndex,column:selectedCellColumn};this.renderSelectOnRows()}else eventName="dblselect";lastClickTime=now,lastClickElm="cell"===this.selection.type?TD:TR,this._dispatchSelectEvent(eventName,dataIndex,selectedCellColumn,trackByData)}else this.selectedItems.clear(),console.warn("selected row is not pointing to a valid data"),this.repositionTables(null,null,!0)}},storkGrid.prototype.onDataClickMove=function(e){for(var dataIndex,TR,trackByData,TD=e.target,i=0;"TD"!==TD.tagName.toUpperCase();){if(i++>=2)return;TD=TD.parentNode}if(TR=TD.parentNode,TR!==this.hoveredRowElm&&(this.hoveredRowElm=TR,dataIndex=parseInt(TR.storkGridProps.dataIndex,10),dataIndex>=0&&dataIndex<this.data.length&&dataIndex<=Number.MAX_SAFE_INTEGER)){this.selectedItems.clear();var smallIndex=Math.min(dataIndex,this.clickedItem.dataIndex),bigIndex=Math.max(dataIndex,this.clickedItem.dataIndex);for(i=smallIndex;bigIndex>=i;i++)trackByData=this.trackBy?this.data[i][this.trackBy]:this.data[i],this.selectedItems.set(trackByData,[this.clickedItem.column]);this.renderSelectOnRows()}},storkGrid.prototype._getTrackByData=function(dataIndex){if(this.trackBy){if("undefined"!=typeof this.data[dataIndex][this.trackBy]&&null!==this.data[dataIndex][this.trackBy])return this.data[dataIndex][this.trackBy];console.warn("Invalid track-by ("+this.trackBy+") for data row (index: "+dataIndex+"):",this.data[dataIndex])}return this.data[dataIndex]},storkGrid.prototype._toggleSelectedClasses=function(dataIndex,rowObj){var selectedItem,dataKeyName,tdDiv,trackByData=this._getTrackByData(dataIndex);for(this.selectedItems.has(trackByData)?(rowObj.row.classList.add("selected"),rowObj.rowFixed.classList.add("selected"),rowObj.row.storkGridProps.selected=!0,this.clickedItem&&this.clickedItem.dataIndex===dataIndex&&(rowObj.row.classList.add("clicked"),rowObj.rowFixed.classList.add("clicked"))):rowObj.row.storkGridProps.selected&&(rowObj.row.classList.remove("selected"),rowObj.rowFixed.classList.remove("selected"),rowObj.row.storkGridProps.selected=!1,this.clickedItem&&this.clickedItem.dataIndex===dataIndex||(rowObj.row.classList.remove("clicked"),rowObj.rowFixed.classList.remove("clicked"))),selectedItem=this.selectedItems.has(trackByData)?this.selectedItems.get(trackByData):null,i=0;i<this.columns.length;i++)dataKeyName=this.columns[i].dataName,tdDiv=rowObj.tds[i].firstChild,selectedItem&&"cell"===this.selection.type&&selectedItem.indexOf(dataKeyName)>-1?(rowObj.tds[i].classList.add("selected"),rowObj.tds[i].storkGridProps.selected=!0):rowObj.tds[i].storkGridProps.selected&&(rowObj.tds[i].classList.remove("selected"),rowObj.tds[i].storkGridProps.selected=!1)},storkGrid.prototype.renderSelectOnRows=function(){var i,j,dataIndex;for(i=0;i<this.dataTables.length;i++)for(j=0;j<this.dataTables[i].rows.length;j++)dataIndex=this.dataTables[i].rows[j].row.storkGridProps.dataIndex,dataIndex>=this.data.length||this._toggleSelectedClasses(dataIndex,this.dataTables[i].rows[j])},storkGrid.prototype.onCopy=function(e){if(this.grid.classList.contains("focused")&&this.selectedItems.size>0){var i,j,trackByData,text="",html="<table><tbody>";for(i=0;i<this.data.length;i++)if(trackByData=this.trackBy?this.data[i][this.trackBy]:this.data[i],this.selectedItems.has(trackByData)){for(html+="<tr>",j=0;j<this.columns.length;j++)text+=this.data[i][this.columns[j].dataName]+" ",html+="<td>"+this.data[i][this.columns[j].dataName]+"</td>";text=text.slice(0,-1)+"\n",html+="</tr>"}text=text.slice(0,-1),html+="</tbody></table>",e.clipboardData.setData("text/plain",text),e.clipboardData.setData("text/html",html),e.preventDefault()}},storkGrid.prototype.onHeaderClick=function(e){for(var TH=e.target,i=0;"TH"!==TH.tagName.toUpperCase();){if(i++>=2)return;TH=TH.parentNode}for(i=0;i<this.headerTable.ths.length;i++)this.headerTable.ths[i]!==TH&&(this.headerTable.ths[i].classList.remove("ascending"),this.headerTable.ths[i].classList.remove("descending"),this.headerTable.ths[i].storkGridProps.sortState=null);"ascending"===TH.storkGridProps.sortState?(TH.classList.remove("ascending"),TH.classList.add("descending"),TH.storkGridProps.sortState="descending"):"descending"===TH.storkGridProps.sortState?(TH.classList.remove("descending"),TH.storkGridProps.sortState=null):(TH.classList.add("ascending"),TH.storkGridProps.sortState="ascending");var evnt=new CustomEvent("sort",{bubbles:!0,cancelable:!0,detail:{column:TH.storkGridProps.column,state:TH.storkGridProps.sortState}});this.grid.dispatchEvent(evnt)},storkGrid.prototype.updateViewData=function(tableIndex,dataBlockIndex){var tableObj,firstBlockRow,lastBlockRow,row,rowObj,dataKeyName,dataIndex,i,tdDiv,dataValue;for(tableObj=this.dataTables[tableIndex],firstBlockRow=dataBlockIndex*this.numDataRowsInTable,lastBlockRow=(dataBlockIndex+1)*this.numDataRowsInTable-1,row=0,dataIndex=firstBlockRow;lastBlockRow>=dataIndex;dataIndex++,row++)if(rowObj=tableObj.rows[row],rowObj.row.storkGridProps.dataIndex=dataIndex,this.data[dataIndex])for(this._toggleSelectedClasses(dataIndex,rowObj),i=0;i<this.columns.length;i++)dataKeyName=this.columns[i].dataName,tdDiv=rowObj.tds[i].firstChild,dataValue=this.data[dataIndex][dataKeyName],"string"!=typeof dataValue&&"number"!=typeof dataValue&&(dataValue=""),this.columns[i].render?this.columns[i].render(tdDiv,dataValue):tdDiv.firstChild?tdDiv.firstChild&&(tdDiv.firstChild.nodeValue=dataValue):tdDiv.appendChild(document.createTextNode(dataValue));else for(i=0;i<this.columns.length;i++)tdDiv=rowObj.tds[i].firstChild,tdDiv.firstChild&&(tdDiv.firstChild.nodeValue="");tableObj.dataBlockIndex=dataBlockIndex},storkGrid.prototype.makeColumnsResizable=function(){var resizer,i,tbody,tr,trFixed,td,span,colResizers=document.getElementById("grid"+this.rnd+"_columnResizers"),colResizersFixed=document.getElementById("grid"+this.rnd+"_columnResizers_fixed");if(colResizers){for(tr=colResizers.querySelector("tr"),trFixed=colResizersFixed.querySelector("tr");tr.firstChild;)tr.removeChild(tr.firstChild);for(;trFixed.firstChild;)trFixed.removeChild(trFixed.firstChild)}else colResizers=document.createElement("table"),colResizers.id="grid"+this.rnd+"_columnResizers",colResizers.classList.add("loose"),colResizers.classList.add("resizers"),this.headerTable.resizer_loose=colResizers,colResizersFixed=document.createElement("table"),colResizersFixed.id="grid"+this.rnd+"_columnResizers_fixed",colResizersFixed.classList.add("fixed"),colResizersFixed.classList.add("resizers"),this.headerTable.resizer_fixed=colResizersFixed,tbody=document.createElement("tbody"),tr=document.createElement("tr"),tbody.appendChild(tr),colResizers.appendChild(tbody),this.headerTable.wrapper.insertBefore(colResizers,this.headerTable.wrapper.firstChild),tbody=document.createElement("tbody"),trFixed=document.createElement("tr"),tbody.appendChild(trFixed),colResizersFixed.appendChild(tbody),this.headerTable.wrapper.insertBefore(colResizersFixed,this.headerTable.wrapper.firstChild),span=document.createElement("span"),span.id="grid"+this.rnd+"_dragPlaceholder",this.headerTable.wrapper.appendChild(span);for(i=0;i<this.columns.length;i++)td=document.createElement("td"),td.classList.add(this.columns[i].dataName),resizer=document.createElement("a"),resizer.style.right="-2px",resizer.setAttribute("draggable","true"),resizer.storkGridProps={dragStartX:0,columnIndex:i},this.setResizeByDragging(resizer,this.columns[i]),td.appendChild(resizer),this.columns[i].fixed?trFixed.appendChild(td):tr.appendChild(td)},storkGrid.prototype.setResizeByDragging=function(elm){var self=this,columnObj=self.columns[elm.storkGridProps.columnIndex];this._addEventListener(elm,"dragstart",function(e){e.dataTransfer.setDragImage(document.getElementById("grid"+self.rnd+"_dragPlaceholder"),0,0),elm.storkGridProps.dragStartX=e.screenX,elm.classList.add("dragging")}),this._addEventListener(elm,"drag",function(e){if(0!==e.screenX){var delta=e.screenX-elm.storkGridProps.dragStartX,newColumnWidth=columnObj.width+delta,minWidth=Math.max(columnObj.minWidth,self.minColumnWidth);minWidth>newColumnWidth&&(delta=minWidth-columnObj.width),changeTranslate(elm,"X",delta)}}),this._addEventListener(elm,"dragend",function(e){elm.classList.remove("dragging"),elm.style.transform="";var delta=e.screenX-elm.storkGridProps.dragStartX;columnObj.width=Math.max(columnObj.width+delta,columnObj.minWidth,self.minColumnWidth),self.calculateColumnsWidths(),self.makeCssRules();var evnt=new CustomEvent("resize-column",{bubbles:!0,cancelable:!0,detail:{columnIndex:elm.storkGridProps.columnIndex,width:columnObj.width}});self.grid.dispatchEvent(evnt)})},storkGrid.prototype.resize=function(){this.resizeCalculate(),this.buildDataTables(),this.repositionTables(null,null,!0)},storkGrid.prototype.setData=function(data){this.data=data,this.refresh()},storkGrid.prototype.refresh=function(){this.calculateDataHeight(),this.repositionTables(null,null,!0)},storkGrid.prototype.destroy=function(){var i,j,k,rows=this.grid.querySelectorAll("tr"),cells=this.grid.querySelectorAll("th, td");for(this._emptyEventListeners(),i=0;i<cells.length;i++)cells[i].parentNode.removeChild(cells[i]);for(i=0;i<rows.length;i++)rows[i].parentNode.removeChild(rows[i]);for(;this.grid.firstChild;)this.grid.removeChild(this.grid.firstChild);for(this.grid.classList.remove("stork-grid","stork-grid"+this.rnd),delete this.grid,delete this.data,delete this.rowHeight,delete this.headerHeight,delete this.columns,delete this.minColumnWidth,delete this.resizableColumns,delete this.sortable,delete this.trackBy,delete this.selection,delete this.onload,delete this.tableExtraSize,delete this.tableExtraPixelsForThreshold,i=0;i<this.headerTable.ths.length;i++)this.headerTable.ths[i]=null;for(delete this.headerTable,i=0;i<this.dataTables;i++)for(j=0;j<this.dataTables[i].rows.length;j++){for(k=0;k<this.dataTables[i].rows[j].tds.length;k++)this.dataTables[i].rows[j].tds[k]=null;this.dataTables[i].rows[j]=null}delete this.dataTables,delete this.dataWrapperElm,delete this.dataElm,delete this.selectedItems,delete this.customScrollEvents,delete this.eventListeners,delete this.scrollX,delete this.scrollY,delete this.maxScrollY,delete this.lastScrollTop,delete this.lastScrollDirection,delete this.lastScrollLeft,delete this.lastThreshold,delete this.nextThreshold,delete this.totalDataWidthFixed,delete this.totalDataWidthLoose,delete this.totalDataHeight,delete this.dataViewHeight,delete this.dataTableHeight,delete this.numDataRowsInTable},storkGrid.prototype.setColumns=function(columns){var options={};options.columns=columns,options.element=this.grid,options.data=this.data,options.rowHeight=this.rowHeight,options.headerHeight=this.headerHeight,options.minColumnWidth=this.minColumnWidth,options.resizableColumns=this.resizableColumns,options.sortable=this.sortable,options.trackBy=this.trackBy,options.onload=this.onload,options.selection=this.selection,this.destroy(),this.constructor(options)},storkGrid.prototype._onClickCheckFocus=function(e){for(var target=e.target;!(target instanceof HTMLDocument)&&target!==this.grid;)if(target=target.parentNode,target&&target instanceof HTMLDocument)return void this.grid.classList.remove("focused");this.grid.classList.add("focused")},storkGrid.prototype._onKeyboardNavigate=function(e){var key=keyboardMap[e.keyCode];if(this.clickedItem&&("DOWN"===key||"UP"===key)){if("DOWN"===key&&this.clickedItem.dataIndex<this.data.length-1)this.clickedItem.dataIndex++;else{if(!("UP"===key&&this.clickedItem.dataIndex>0))return;this.clickedItem.dataIndex--}e.preventDefault();var trackByData=this._getTrackByData(this.clickedItem.dataIndex);this.selectedItems.clear(),this.selectedItems.set(trackByData,[this.clickedItem.column]);var clickedItemY=this.clickedItem.dataIndex*this.rowHeight;clickedItemY<this.scrollY?(this.scrollY=clickedItemY,this.onScrollY(clickedItemY)):clickedItemY>this.scrollY+this.dataViewHeight-this.rowHeight&&(this.scrollY=clickedItemY-this.dataViewHeight+this.rowHeight,
this.onScrollY(clickedItemY-this.dataViewHeight+this.rowHeight)),this.renderSelectOnRows(),this._dispatchSelectEvent("select",this.clickedItem.dataIndex,this.clickedItem.column,trackByData)}},root.storkGrid=storkGrid}(window);
//# sourceMappingURL=data-grid.min.js.map